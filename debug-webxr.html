<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug WebXR - Quest 3</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: white;
            font-family: monospace;
            font-size: 16px;
        }
        
        .big-button {
            display: block;
            width: 90%;
            padding: 30px;
            margin: 20px auto;
            background: #00d4aa;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
        }
        
        .debug {
            background: #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîç WebXR Debug Tool</h1>
    
    <button class="big-button" onclick="testButton()">
        TEST BUTTON CLICK
    </button>
    
    <button class="big-button" onclick="checkWebXR()">
        CHECK WEBXR SUPPORT
    </button>
    
    <button class="big-button" onclick="requestPermissions()">
        REQUEST PERMISSIONS
    </button>
    
    <button class="big-button" onclick="startSimpleAR()">
        START SIMPLE AR
    </button>
    
    <div class="debug" id="output">
Debug Output:
Initializing...
    </div>

    <script>
        const output = document.getElementById('output');
        
        function log(message) {
            const time = new Date().toLocaleTimeString();
            output.textContent += '\n' + time + ': ' + message;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function testButton() {
            log('‚úÖ Button click works!');
            log('User agent: ' + navigator.userAgent);
            log('Is Quest: ' + /OculusBrowser/.test(navigator.userAgent));
        }
        
        async function checkWebXR() {
            log('üîç Checking WebXR...');
            
            if (!navigator.xr) {
                log('‚ùå navigator.xr not found');
                return;
            }
            
            log('‚úÖ navigator.xr exists');
            
            try {
                const arSupported = await navigator.xr.isSessionSupported('immersive-ar');
                log('AR supported: ' + arSupported);
                
                const vrSupported = await navigator.xr.isSessionSupported('immersive-vr');
                log('VR supported: ' + vrSupported);
                
                log('‚úÖ WebXR checks complete');
            } catch (error) {
                log('‚ùå WebXR check error: ' + error.message);
            }
        }
        
        async function requestPermissions() {
            log('üîê Testing permissions...');
            
            try {
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    log('üìπ Requesting camera permission...');
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    log('‚úÖ Camera permission granted');
                    stream.getTracks().forEach(track => track.stop());
                } else {
                    log('‚ùå getUserMedia not available');
                }
            } catch (error) {
                log('‚ùå Permission error: ' + error.message);
            }
        }
        
        async function startSimpleAR() {
            log('üöÄ Attempting simple AR session...');
            
            if (!navigator.xr) {
                log('‚ùå No WebXR');
                return;
            }
            
            try {
                log('üì± Requesting AR session...');
                const session = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local-floor']
                });
                
                log('‚úÖ AR session created!');
                log('Session ID: ' + session.sessionId || 'unknown');
                log('Input sources: ' + session.inputSources.length);
                
                // End session after 5 seconds
                setTimeout(() => {
                    session.end();
                    log('üõë Session ended');
                }, 5000);
                
            } catch (error) {
                log('‚ùå AR session failed: ' + error.message);
                log('Error stack: ' + error.stack);
            }
        }
        
        // Initialize
        log('ü•Ω Debug tool ready');
        log('Quest browser: ' + /OculusBrowser/.test(navigator.userAgent));
        log('WebXR available: ' + !!navigator.xr);
        log('Secure context: ' + window.isSecureContext);
        log('Protocol: ' + window.location.protocol);
    </script>
</body>
</html>