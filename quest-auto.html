<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest 3 Auto-Detect AR</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        model-viewer {
            width: 100%;
            height: 100%;
        }

        .ar-button {
            background: linear-gradient(45deg, #00d4aa 0%, #00a085 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: 700;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 212, 170, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .ar-button:hover {
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 12px 35px rgba(0, 212, 170, 0.6);
        }

        .info {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            z-index: 1000;
            max-width: 90%;
        }

        .quest-tips {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            max-width: 90%;
            z-index: 1000;
        }

        .browser-info {
            position: absolute;
            top: 80px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 11px;
            max-width: 250px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="info" id="status">
        <strong>ü•Ω Quest 3 Detection...</strong>
    </div>

    <div class="browser-info" id="browserInfo">
        Loading browser info...
    </div>

    <model-viewer
        id="hotelModel"
        src="model.glb"
        ar
        ar-modes="webxr scene-viewer quick-look"
        camera-controls
        shadow-intensity="1"
        exposure="1"
        camera-orbit="0deg 70deg 15m"
        scale="0.04 0.04 0.04"
        interaction-prompt="auto"
        ar-scale="auto"
        ar-placement="floor"
        loading="eager"
        reveal="auto"
        alt="Hotel 3D Model">
        
        <button slot="ar-button" class="ar-button" id="arButton">
            üè® Launch AR
        </button>
    </model-viewer>

    <div class="quest-tips" id="tips">
        <strong>Quest 3 Tips:</strong><br>
        ‚Ä¢ Make sure you're in a well-lit room<br>
        ‚Ä¢ Clear space around you for room tracking<br>
        ‚Ä¢ Allow camera permissions when prompted
    </div>

    <script>
        const modelViewer = document.getElementById('hotelModel');
        const status = document.getElementById('status');
        const browserInfo = document.getElementById('browserInfo');
        const arButton = document.getElementById('arButton');
        const tips = document.getElementById('tips');

        // Comprehensive browser and device detection
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            const info = {
                userAgent: ua,
                isQuest: /OculusBrowser/.test(ua),
                isMobile: /Android|iPhone|iPad/.test(ua),
                hasWebXR: !!navigator.xr,
                hasMediaDevices: !!navigator.mediaDevices,
                hasGetUserMedia: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
                isSecureContext: window.isSecureContext,
                protocol: window.location.protocol,
                vendor: navigator.vendor,
                platform: navigator.platform,
                language: navigator.language
            };
            
            return info;
        }

        // Display browser info
        function displayBrowserInfo(info) {
            browserInfo.innerHTML = `
                Quest: ${info.isQuest ? '‚úÖ' : '‚ùå'}<br>
                WebXR: ${info.hasWebXR ? '‚úÖ' : '‚ùå'}<br>
                Camera: ${info.hasGetUserMedia ? '‚úÖ' : '‚ùå'}<br>
                Secure: ${info.isSecureContext ? '‚úÖ' : '‚ùå'}<br>
                Protocol: ${info.protocol}<br>
                Vendor: ${info.vendor}
            `;
        }

        // Configure for Quest 3
        async function configureForQuest() {
            const info = getBrowserInfo();
            displayBrowserInfo(info);

            if (info.isQuest) {
                status.innerHTML = '<strong>üéØ Quest 3 Detected!</strong><br>Optimizing for VR browser...';
                
                // Quest-specific optimizations
                modelViewer.setAttribute('scale', '0.02 0.02 0.02');
                modelViewer.setAttribute('camera-orbit', '0deg 65deg 12m');
                
                // Check WebXR support
                if (info.hasWebXR) {
                    try {
                        const arSupported = await navigator.xr.isSessionSupported('immersive-ar');
                        const vrSupported = await navigator.xr.isSessionSupported('immersive-vr');
                        
                        if (arSupported) {
                            status.innerHTML = '<strong>‚úÖ Quest 3 AR Ready!</strong><br>WebXR AR is supported';
                            tips.innerHTML = '<strong>Quest 3 AR Mode:</strong><br>‚Ä¢ Hand tracking enabled<br>‚Ä¢ Point and pinch to interact<br>‚Ä¢ Walk around the hotel model';
                        } else if (vrSupported) {
                            status.innerHTML = '<strong>ü•Ω Quest 3 VR Ready!</strong><br>WebXR VR is supported';
                            arButton.textContent = 'ü•Ω Launch VR';
                        } else {
                            status.innerHTML = '<strong>‚ö†Ô∏è Quest 3 Basic Mode</strong><br>WebXR features limited';
                            arButton.textContent = 'üîç View Model';
                            setupFallbackMode();
                        }
                    } catch (error) {
                        console.log('WebXR check failed:', error);
                        status.innerHTML = '<strong>üîÑ Quest 3 Fallback</strong><br>Using alternative AR mode';
                        setupFallbackMode();
                    }
                } else {
                    status.innerHTML = '<strong>üì± Quest 3 Browser Mode</strong><br>WebXR not available';
                    setupFallbackMode();
                }
            } else if (info.isMobile) {
                status.innerHTML = '<strong>üì± Mobile Device</strong><br>AR mode available';
            } else {
                status.innerHTML = '<strong>üíª Desktop Mode</strong><br>3D viewing only';
            }
        }

        // Fallback mode for when WebXR isn't available
        function setupFallbackMode() {
            arButton.onclick = () => {
                // Create immersive fullscreen experience
                document.body.style.background = '#000';
                modelViewer.setAttribute('scale', '0.08 0.08 0.08');
                modelViewer.setAttribute('camera-orbit', '0deg 60deg 8m');
                modelViewer.setAttribute('auto-rotate', 'true');
                
                // Hide UI
                status.style.display = 'none';
                tips.style.display = 'none';
                browserInfo.style.display = 'none';
                
                // Show exit button
                const exitBtn = document.createElement('button');
                exitBtn.textContent = '‚ùå Exit';
                exitBtn.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(255, 0, 0, 0.8);
                    color: white;
                    border: none;
                    padding: 15px 20px;
                    border-radius: 10px;
                    cursor: pointer;
                    z-index: 1000;
                `;
                exitBtn.onclick = () => location.reload();
                document.body.appendChild(exitBtn);
                
                // Try fullscreen
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(() => {
                        console.log('Fullscreen not available');
                    });
                }
            };
        }

        // Handle AR session events
        modelViewer.addEventListener('ar-status', (event) => {
            console.log('AR Status:', event.detail.status);
            
            if (event.detail.status === 'session-started') {
                status.innerHTML = '<strong>üéØ AR Active!</strong><br>Use hand gestures to interact';
            } else if (event.detail.status === 'failed') {
                status.innerHTML = '<strong>‚ùå AR Failed</strong><br>Check camera permissions';
            }
        });

        // Model loading
        modelViewer.addEventListener('load', () => {
            console.log('Hotel model loaded successfully');
        });

        // Initialize
        configureForQuest();
    </script>
</body>
</html>